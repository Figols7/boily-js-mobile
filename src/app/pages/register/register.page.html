<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/login"></ion-back-button>
    </ion-buttons>
    <ion-title>Create Account</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <div class="register-container">
    <!-- Logo or App Name -->
    <div class="logo-section">
      <ion-icon name="rocket-outline" class="app-icon"></ion-icon>
      <h1>Join BoilyJS</h1>
      <p class="subtitle">Start building your SaaS today</p>
    </div>

    <!-- Register Form -->
    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
      <!-- First Name -->
      <ion-item lines="full" [class.ion-invalid]="firstNameErrors">
        <ion-label position="floating">First Name</ion-label>
        <ion-input
          type="text"
          formControlName="firstName"
          placeholder="Enter your first name"
        ></ion-input>
      </ion-item>
      @if (firstNameErrors) {
        <ion-note color="danger" class="error-message">
          {{ firstNameErrors }}
        </ion-note>
      }

      <!-- Last Name -->
      <ion-item lines="full" [class.ion-invalid]="lastNameErrors">
        <ion-label position="floating">Last Name</ion-label>
        <ion-input
          type="text"
          formControlName="lastName"
          placeholder="Enter your last name"
        ></ion-input>
      </ion-item>
      @if (lastNameErrors) {
        <ion-note color="danger" class="error-message">
          {{ lastNameErrors }}
        </ion-note>
      }

      <!-- Email -->
      <ion-item lines="full" [class.ion-invalid]="emailErrors">
        <ion-label position="floating">Email</ion-label>
        <ion-input
          type="email"
          formControlName="email"
          placeholder="your@email.com"
          autocomplete="email"
        ></ion-input>
      </ion-item>
      @if (emailErrors) {
        <ion-note color="danger" class="error-message">
          {{ emailErrors }}
        </ion-note>
      }

      <!-- Password -->
      <ion-item lines="full" [class.ion-invalid]="passwordErrors">
        <ion-label position="floating">Password</ion-label>
        <ion-input
          [type]="showPassword ? 'text' : 'password'"
          formControlName="password"
          placeholder="Enter your password"
          autocomplete="new-password"
        ></ion-input>
        <ion-button
          slot="end"
          fill="clear"
          (click)="togglePasswordVisibility()"
          type="button"
        >
          <ion-icon
            [name]="showPassword ? 'eye-off-outline' : 'eye-outline'"
            slot="icon-only"
          ></ion-icon>
        </ion-button>
      </ion-item>
      @if (passwordErrors) {
        <ion-note color="danger" class="error-message">
          {{ passwordErrors }}
        </ion-note>
      }

      <!-- Password Strength Indicator -->
      @if (registerForm.get('password')?.value) {
      <div class="password-strength">
        <ion-text [color]="getPasswordStrengthColor()">
          Password Strength: <strong>{{ getPasswordStrengthText() }}</strong>
        </ion-text>
        <ion-progress-bar
          [value]="passwordStrength / 100"
          [color]="getPasswordStrengthColor()"
        ></ion-progress-bar>
      </div>
      }

      <!-- Confirm Password -->
      <ion-item lines="full" [class.ion-invalid]="confirmPasswordErrors">
        <ion-label position="floating">Confirm Password</ion-label>
        <ion-input
          [type]="showConfirmPassword ? 'text' : 'password'"
          formControlName="confirmPassword"
          placeholder="Confirm your password"
          autocomplete="new-password"
        ></ion-input>
        <ion-button
          slot="end"
          fill="clear"
          (click)="toggleConfirmPasswordVisibility()"
          type="button"
        >
          <ion-icon
            [name]="showConfirmPassword ? 'eye-off-outline' : 'eye-outline'"
            slot="icon-only"
          ></ion-icon>
        </ion-button>
      </ion-item>
      @if (confirmPasswordErrors) {
        <ion-note color="danger" class="error-message">
          {{ confirmPasswordErrors }}
        </ion-note>
      }

      <!-- Terms and Conditions -->
      <ion-item lines="none" class="terms-item">
        <ion-checkbox
          slot="start"
          formControlName="termsAccepted"
        ></ion-checkbox>
        <ion-label class="ion-text-wrap">
          I agree to the
          <a href="#" class="terms-link">Terms of Service</a> and
          <a href="#" class="terms-link">Privacy Policy</a>
        </ion-label>
      </ion-item>
      @if (registerForm.get('termsAccepted')?.touched && registerForm.get('termsAccepted')?.errors) {
        <ion-note
          color="danger"
          class="error-message"
        >
          You must accept the terms and conditions
        </ion-note>
      }

      <!-- Register Button -->
      <ion-button
        expand="block"
        type="submit"
        [disabled]="registerForm.invalid || isLoading"
        class="register-button"
      >
        @if (isLoading) {
          <ion-spinner name="crescent"></ion-spinner>
        }
        @if (!isLoading) {
          <span>Create Account</span>
        }
      </ion-button>
    </form>

    <!-- Divider -->
    <div class="divider">
      <ion-text color="medium">or</ion-text>
    </div>

    <!-- Google Sign Up -->
    <ion-button
      expand="block"
      fill="outline"
      (click)="loginWithGoogle()"
      class="google-button"
    >
      <ion-icon name="logo-google" slot="start"></ion-icon>
      Sign up with Google
    </ion-button>

    <!-- Apple Sign Up -->
    <ion-button
      expand="block"
      fill="solid"
      color="dark"
      (click)="loginWithApple()"
      class="apple-button"
    >
      <ion-icon name="logo-apple" slot="start"></ion-icon>
      Sign up with Apple
    </ion-button>

    <!-- Login Link -->
    <div class="login-link">
      <ion-text color="medium">
        Already have an account?
        <a (click)="navigateToLogin()" class="link-text">Sign In</a>
      </ion-text>
    </div>
  </div>
</ion-content>
